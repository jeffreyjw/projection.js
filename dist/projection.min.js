
/*
 * -------------------------------------------------------
 * Project: projection.js
 * Version: 0.1.0
 *
 * Author:  jeffreyjw
 * Site:     https://github.com/jeffreyjw
 * Contact: jjwojtczak@gmail.com
 *
 *
 * Copyright (c) 2014 jeffreyjw
 * -------------------------------------------------------
 */

"use strict";var PROJECTION;PROJECTION=PROJECTION||{},PROJECTION.Camera=function(){function Camera(fieldOfView,aspectRatio,zNear,zFar){this.fieldOfView=fieldOfView,this.aspectRatio=aspectRatio,this.zNear=zNear,this.zFar=zFar,this._createMatrices()}return Camera.prototype.fieldOfView=null,Camera.prototype.aspectRatio=null,Camera.prototype.zNear=null,Camera.prototype.zFar=null,Camera.prototype.projectionMatrix=null,Camera.prototype.viewMatrix=null,Camera.prototype._createMatrices=function(){return this.projectionMatrix=mat4.create(),mat4.perspective(this.projectionMatrix,this.fieldOfView,this.aspectRatio,this.zNear,this.zFar),this.viewMatrix=mat4.create(),mat4.lookAt(this.viewMatrix,[0,0,1],[0,0,0],[0,1,0])},Camera.prototype.transform=function(vec,modelMatrix){var outVec;return outVec=vec3.create(),vec3.transformMat4(outVec,vec,modelMatrix),vec3.transformMat4(outVec,outVec,this.viewMatrix),vec3.transformMat4(outVec,outVec,this.projectionMatrix),outVec},Camera}(),PROJECTION.Node=function(){function Node(parent){null==parent&&(parent=null),this.parent=parent,this.children=[],parent&&this.parent.children.push(this),this.matrix=mat4.create(),this.position=vec3.create()}return Node.prototype.position=null,Node.prototype.scale=0,Node.prototype.parent=null,Node.prototype.children=null,Node.prototype.matrix=null,Node.prototype.update=function(){var child,_i,_len,_ref,_results;for(null!==this.parent?mat4.translate(this.matrix,this.parent.matrix,this.position):mat4.translate(this.matrix,mat4.create(),this.position),_ref=this.children,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],_results.push(child.update());return _results},Node.prototype.getData2d=function(camera){var out,vec;return out={position:null,scale:null},vec=null,vec=null!==this.parent?camera.transform(this.position,this.parent.matrix):camera.transform(this.position,mat4.create()),0===vec[2]?(out.position=[0,0],out.scale=0):(out.scale=-1/vec[2],out.position=[vec[0]*out.scale,vec[1]*out.scale]),out},Node}();